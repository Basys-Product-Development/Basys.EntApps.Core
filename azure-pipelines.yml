trigger:
- main

pool:
  vmImage: 'windows-latest'

steps:
- task: UseDotNet@2
  inputs:
    packageType: 'sdk'
    version: '8.x'  # .NET 8 SDK

- script: dotnet restore
  displayName: 'Restore dependencies'

- script: dotnet build --configuration Release
  displayName: 'Build project'

- script: dotnet pack --configuration Release --output $(Build.ArtifactStagingDirectory)
  displayName: 'Create NuGet package'

- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: '$(Build.ArtifactStagingDirectory)'
    artifactName: 'nupkg'

- task: NuGetAuthenticate@1
  inputs:
    nuGetServiceConnections: 'Basys.EntApps.Core'

- script: dotnet nuget push "$(Build.ArtifactStagingDirectory)/*.nupkg" \
          --source "MyCompanyPackages" \
          --api-key AzureArtifacts
  displayName: 'Publish package to Azure Artifacts'
